<%= form_with(model: cluster) do |form| %>
  <%= render "shared/error_messages", resource: form.object %>

  <div class="space-y-8">
    <%= render(FormFieldComponent.new(
      label: "Name",
      description: "A unique name for your cluster, only lowercase letters, numbers, and hyphens are allowed."
    )) do %>
      <%= form.text_field :name, class: "input input-bordered w-full focus:outline-offset-0", autofocus: true, required: true %>
      <label class="label">
        <span class="label-text-alt">* Required</span>
      </label>
    <% end %>

    <div data-controller="card-select">
      <label class="mb-4 inline-block">Which managed Kubernetes provider are you using?</label>
      <div class="form-group">
        <div class="flex gap-4 flex-wrap">
          <%= form.collection_select :cluster_type,
            Cluster.cluster_types.keys,
            :to_s,
            :titleize,
            { },
            { class: "select select-bordered hidden", data: { "card-select-target": "input" } }
          %>
          <%= render "clusters/cluster_types/cards/local_k3s" %>
          <%= render "clusters/cluster_types/cards/k3s" %>
          <%= render "clusters/cluster_types/cards/k8s" %>
        </div>
      </div>

      <div class="my-10 has-styled-links">
        <%= render "clusters/cluster_types/instructions/k8s", form: form %>
        <%= render "clusters/cluster_types/instructions/k3s", form: form %>
        <%= render "clusters/cluster_types/instructions/local_k3s", form: form %>
      </div>
    </div>

    <div>
      <label class="mb-4 inline-block font-semibold">System Packages</label>
      <p class="text-sm text-gray-400 mb-4">Select packages to install on your cluster.</p>
      <div class="space-y-3">
        <% ClusterPackage.definitions.each do |definition| %>
          <div <%= "data-controller=content-toggle" if definition['template'].present? %> class="bg-base-200 rounded-lg">
            <label class="flex items-center gap-3 p-3 cursor-pointer">
              <input type="checkbox"
                     name="package_names[]"
                     value="<%= definition['name'] %>"
                     class="checkbox"
                     <%= 'checked' if definition['default'] %>
                     <% if definition['template'].present? %>
                       data-action="change->content-toggle#toggleEdit"
                     <% end %> />
              <iconify-icon icon="<%= definition['icon'] %>" height="24"></iconify-icon>
              <div>
                <span class="font-semibold"><%= definition['display_name'] %></span>
                <p class="text-sm text-gray-400"><%= definition['description'] %></p>
              </div>
            </label>

            <% if definition['template'].present? %>
              <div data-content-toggle-target="editorContainer" class="hidden px-3 pb-3 pl-11 space-y-2">
                <% if definition['help_text'].present? %>
                  <div class="text-sm text-gray-400"><%= definition['help_text'].html_safe %></div>
                <% end %>
                <% definition['template'].each do |variable| %>
                  <%= render "clusters/cluster_packages/template_variable", variable: variable, definition: definition %>
                <% end %>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

  </div>

<% end %>
